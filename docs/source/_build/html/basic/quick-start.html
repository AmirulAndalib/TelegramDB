<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick-Start &mdash; TelegramDB 0.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TelegramDB" href="../tgdb/telegramdb.html" />
    <link rel="prev" title="Authorizing" href="authorizing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> TelegramDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorizing.html">Authorizing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick-Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TelegramDB</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tgdb/telegramdb.html">TelegramDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tgdb/datapack.html">DataPack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tgdb/member.html">Member</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TelegramDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Quick-Start</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/basic/quick-start.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quick-start">
<span id="id1"></span><h1>Quick-Start<a class="headerlink" href="#quick-start" title="Permalink to this headline"></a></h1>
<p>Let’s see a longer example to learn some of the methods that the library
has to offer. These are known as “friendly methods”, and you should always
use these if possible.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span><span class="o">,</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">getenv</span>
<span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">idle</span><span class="p">,</span> <span class="n">filters</span>
<span class="kn">from</span> <span class="nn">pyrogram.types</span> <span class="kn">import</span> <span class="n">Message</span>
<span class="kn">from</span> <span class="nn">telegramdb</span> <span class="kn">import</span> <span class="n">TelegramDB</span><span class="p">,</span> <span class="n">DataPack</span><span class="p">,</span> <span class="n">Member</span>

<span class="c1"># Creating a telegram client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s2">&quot;session_name&quot;</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;API_ID&quot;</span><span class="p">),</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;API_HASH&quot;</span><span class="p">))</span>
<span class="n">client</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># Creating a TelegramDB instance</span>
<span class="n">SESSION</span> <span class="o">=</span> <span class="n">TelegramDB</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DB_CHAT_ID&quot;</span><span class="p">),</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Basic Logging for debugging purpose</span>
<span class="n">LOG_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;-&gt; [TelegramDB Example] [</span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(asctime)s</span><span class="s2">]: </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">LOG_FORMAT</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()],</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># A new datapack class inherited from DataPack</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">DataPack</span><span class="p">):</span>
    <span class="c1"># naming the datapack</span>
    <span class="n">__datapack_name__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>

    <span class="c1"># here we have defined all the members of this datapack</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Member</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">is_primary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Member</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">Member</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>

<span class="c1"># this intialises datapack with its primary keys</span>
<span class="n">SESSION</span><span class="o">.</span><span class="n">prepare_datapack</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

<span class="c1"># insertion lock to avoid duplicate keys</span>
<span class="n">INSERTION_LOCK</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">save_user_data</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">INSERTION_LOCK</span><span class="p">:</span>
        <span class="n">SESSION</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">username</span><span class="p">))</span>

<span class="c1"># this message handler will log users to our database</span>
<span class="nd">@client</span><span class="o">.</span><span class="n">on_message</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">check_users</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">user</span> <span class="o">:=</span> <span class="n">message</span><span class="o">.</span><span class="n">from_user</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">save_user_data</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>

<span class="c1"># this message handler with command filter will be used to retrieve values from the database</span>
<span class="nd">@client</span><span class="o">.</span><span class="n">on_message</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">prefixes</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s2">&quot;You didn&#39;t enter a valid user id!&quot;</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">from_user</span><span class="o">.</span><span class="n">id</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">SESSION</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s2">&quot;User not found in the database.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    **User Info**</span>

<span class="s2">    **UserID**: `</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">`</span>
<span class="s2">    **Name**: `</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`</span>
<span class="s2">    **Username**: `</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">`</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">idle</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>Here, we showed you how to initialize datapacks, commit data,
and get values with the help of a user logging script.</p>
<p>You should make sure that you understand what the code shown here
does, take note on how methods are called and used and so on before
proceeding. We will see all the available methods later on.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="authorizing.html" class="btn btn-neutral float-left" title="Authorizing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tgdb/telegramdb.html" class="btn btn-neutral float-right" title="TelegramDB" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Anony.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>